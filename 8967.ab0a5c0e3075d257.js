"use strict";(self.webpackChunkeprescription_angular=self.webpackChunkeprescription_angular||[]).push([[8967],{8829:(E,f,o)=>{o.d(f,{z:()=>p});var u=o(4412),g=o(7673),c=o(204),d=o(6354),S=o(4438);let p=(()=>{class i{constructor(){this.currentUserSubject=new u.t(null),this.currentUser$=this.currentUserSubject.asObservable(),this.messagesSubject=new u.t([]),this.messages$=this.messagesSubject.asObservable(),this.conversationsSubject=new u.t([]),this.conversations$=this.conversationsSubject.asObservable(),this.PASSWORD_POLICIES={MIN_LENGTH:12,MIN_CHAR_TYPES:3,REQUIRE_UPPERCASE:!0,REQUIRE_LOWERCASE:!0,REQUIRE_NUMBERS:!0,REQUIRE_SYMBOLS:!0},this.MESSAGE_TOPICS=[{value:"consulta-general",label:"Consulta general",description:"Preguntas generales sobre el sistema"},{value:"soporte-tecnico",label:"Soporte t\xe9cnico",description:"Problemas t\xe9cnicos y errores"},{value:"solicitud-permisos",label:"Solicitud de permisos",description:"Solicitar acceso a m\xf3dulos o funciones"},{value:"reporte-problema",label:"Reporte de problema",description:"Reportar errores o problemas del sistema"},{value:"sugerencia-mejora",label:"Sugerencia de mejora",description:"Propuestas de mejoras al sistema"}],this.initializeMockData()}initializeMockData(){this.currentUserSubject.next({id:"user-001",fullName:"Dr. Juan P\xe9rez",email:"juan.perez@hospital.com",phone:"+506 8888-9999",address:"San Jos\xe9, Costa Rica",specialty:"Medicina General",department:"Consulta Externa",username:"jperez"}),this.loadMessagesFromStorage(),this.loadConversationsFromStorage()}getCurrentUser(){return this.currentUser$}updateUserProfile(e){return(0,g.of)(!0).pipe((0,c.c)(1500),(0,d.T)(()=>{const r=this.currentUserSubject.value;if(r){const s={...r,...e};this.currentUserSubject.next(s),console.log("\u{1f510} Actualizaci\xf3n de perfil registrada:",{userId:r.id,changes:e,timestamp:(new Date).toISOString(),compliance:"HIPAA, FDA 21 CFR Part 11"})}return!0}))}changePassword(e){return(0,g.of)(!0).pipe((0,c.c)(1e3),(0,d.T)(()=>(console.log("\u{1f510} Cambio de contrase\xf1a registrado:",{userId:this.currentUserSubject.value?.id,timestamp:(new Date).toISOString(),compliance:"NIST 800-63B, HIPAA, FDA 21 CFR Part 11"}),!0)))}validatePasswordStrength(e,r){let a,n,h,s=0,t=[];if(e.length>=this.PASSWORD_POLICIES.MIN_LENGTH?s+=25:t.push(`M\xednimo ${this.PASSWORD_POLICIES.MIN_LENGTH} caracteres`),/[A-Z]/.test(e)?s+=20:t.push("Incluir may\xfasculas"),/[a-z]/.test(e)?s+=20:t.push("Incluir min\xfasculas"),/[0-9]/.test(e)?s+=20:t.push("Incluir n\xfameros"),/[^a-zA-Z0-9]/.test(e)?s+=15:t.push("Incluir s\xedmbolos especiales"),r){const I=[r.username?.toLowerCase(),r.email?.split("@")[0]?.toLowerCase(),r.fullName?.toLowerCase().split(" ")].flat().filter(Boolean),l=e.toLowerCase();I.some(m=>m&&l.includes(m))&&(s=Math.max(0,s-30),t.push("No debe contener informaci\xf3n personal"))}return s>=80?(a="Muy fuerte",n="bg-green-500",h=!0):s>=60?(a="Fuerte",n="bg-blue-500",h=!0):s>=40?(a="Moderada",n="bg-yellow-500",h=!1):(a="D\xe9bil",n="bg-red-500",h=!1),{strength:s,label:a,color:n,valid:h}}validatePasswordMatch(e,r){return e!==r?{valid:!1,message:"Las contrase\xf1as no coinciden"}:{valid:!0}}validatePasswordDifferent(e,r){return e===r?{valid:!1,message:"La nueva contrase\xf1a debe ser diferente a la actual"}:{valid:!0}}getMessageTopics(){return this.MESSAGE_TOPICS}getMessagingStats(e){const r=this.messagesSubject.value,s=this.conversationsSubject.value;return{totalConversations:s.length,activeConversations:s.filter(t=>"active"===t.status).length,unreadMessages:r.filter(t=>t.toUserId===e&&"sent"===t.status).length,draftMessages:r.filter(t=>t.fromUserId===e&&"draft"===t.status).length}}getConversations(e){return this.conversations$.pipe((0,d.T)(r=>r.filter(s=>s.participants.includes(e))))}getConversationMessages(e){return this.messages$.pipe((0,d.T)(r=>r.filter(s=>s.conversationId===e).sort((s,t)=>new Date(s.createdAt).getTime()-new Date(t.createdAt).getTime())))}sendMessage(e){return(0,g.of)(null).pipe((0,c.c)(1e3),(0,d.T)(()=>{const r={id:`msg-${Date.now()}`,conversationId:e.conversationId||`conv-${Date.now()}`,fromUserId:e.fromUserId,fromUserName:e.fromUserName,toUserId:"admin-001",toUserName:"Administraci\xf3n",subject:e.subject,content:e.content,topic:e.topic,priority:e.priority||"normal",status:e.status||"sent",createdAt:new Date,attachments:e.attachments||[]};return this.messagesSubject.next([...this.messagesSubject.value,r]),this.saveMessagesToStorage(),this.updateOrCreateConversation(r),r}))}updateOrCreateConversation(e){const r=this.conversationsSubject.value;let s=r.find(t=>t.id===e.conversationId);s?(s.lastMessage=e,s.updatedAt=new Date,this.conversationsSubject.next([...r])):(s={id:e.conversationId,subject:e.subject,topic:e.topic,participants:[e.fromUserId,e.toUserId],lastMessage:e,unreadCount:0,status:"active",createdAt:new Date,updatedAt:new Date},this.conversationsSubject.next([...r,s])),this.saveConversationsToStorage()}reloadMessagingData(){this.loadMessagesFromStorage(),this.loadConversationsFromStorage()}addExternalMessage(e){const s=this.MESSAGE_TOPICS.find(t=>t.value===(e.topic||"consulta-general"))||this.MESSAGE_TOPICS[0];return this.sendMessage({topic:s,subject:e.subject,content:e.content,fromUserId:"user-001",fromUserName:e.fromUserName||"Usuario",priority:e.priority||"normal",status:"sent"})}loadMessagesFromStorage(){try{const e=localStorage.getItem("autoservicio_messages");if(e){const r=JSON.parse(e).map(s=>({...s,createdAt:new Date(s.createdAt),readAt:s.readAt?new Date(s.readAt):void 0}));this.messagesSubject.next(r)}else this.createMockMessages()}catch(e){console.error("Error loading messages from storage:",e),this.createMockMessages()}}loadConversationsFromStorage(){try{const e=localStorage.getItem("autoservicio_conversations");if(e){const r=JSON.parse(e).map(s=>({...s,createdAt:new Date(s.createdAt),updatedAt:new Date(s.updatedAt)}));this.conversationsSubject.next(r)}else this.createMockConversations()}catch(e){console.error("Error loading conversations from storage:",e),this.createMockConversations()}}saveMessagesToStorage(){try{localStorage.setItem("autoservicio_messages",JSON.stringify(this.messagesSubject.value))}catch(e){console.error("Error saving messages to storage:",e)}}saveConversationsToStorage(){try{localStorage.setItem("autoservicio_conversations",JSON.stringify(this.conversationsSubject.value))}catch(e){console.error("Error saving conversations to storage:",e)}}createMockMessages(){const e=[{id:"msg-001",conversationId:"conv-001",fromUserId:"user-001",fromUserName:"Dr. Juan P\xe9rez",toUserId:"admin-001",toUserName:"Administraci\xf3n",subject:"Error al generar PDF de receta",content:'Hola, tengo problemas para generar el PDF de las recetas. Cuando hago clic en "Generar PDF" aparece un error y no se descarga el archivo.',topic:this.MESSAGE_TOPICS[1],priority:"normal",status:"sent",createdAt:new Date(Date.now()-864e5-36e5),attachments:[]},{id:"msg-002",conversationId:"conv-001",fromUserId:"admin-001",fromUserName:"Administraci\xf3n",toUserId:"user-001",toUserName:"Dr. Juan P\xe9rez",subject:"Re: Error al generar PDF de receta",content:'Hemos identificado el problema con la generaci\xf3n de PDFs. Se solucionar\xe1 en la pr\xf3xima actualizaci\xf3n del sistema. Mientras tanto, puede usar la opci\xf3n de "Imprimir" como alternativa.',topic:this.MESSAGE_TOPICS[1],priority:"normal",status:"sent",createdAt:new Date(Date.now()-864e5),attachments:[]},{id:"msg-003",conversationId:"conv-002",fromUserId:"user-001",fromUserName:"Dr. Juan P\xe9rez",toUserId:"admin-001",toUserName:"Administraci\xf3n",subject:"Solicitud acceso a m\xf3dulo de reportes",content:"Solicito acceso al m\xf3dulo de reportes para poder generar estad\xedsticas de mis prescripciones.",topic:this.MESSAGE_TOPICS[2],priority:"normal",status:"sent",createdAt:new Date(Date.now()-1728e5-18e5),attachments:[]},{id:"msg-004",conversationId:"conv-002",fromUserId:"admin-001",fromUserName:"Administraci\xf3n",toUserId:"user-001",toUserName:"Dr. Juan P\xe9rez",subject:"Re: Solicitud acceso a m\xf3dulo de reportes",content:"Su solicitud de acceso al m\xf3dulo de reportes ha sido aprobada. Ya puede acceder desde el men\xfa principal. La conversaci\xf3n se marca como cerrada.",topic:this.MESSAGE_TOPICS[2],priority:"normal",status:"sent",createdAt:new Date(Date.now()-1728e5),attachments:[]},{id:"msg-005",conversationId:"conv-003",fromUserId:"user-001",fromUserName:"Dr. Juan P\xe9rez",toUserId:"admin-001",toUserName:"Administraci\xf3n",subject:"Consulta sobre cambio de contrase\xf1a",content:"\xbfCada cu\xe1nto tiempo debo cambiar mi contrase\xf1a? \xbfHay alguna pol\xedtica espec\xedfica que deba seguir?",topic:this.MESSAGE_TOPICS[0],priority:"normal",status:"sent",createdAt:new Date(Date.now()-2592e5),attachments:[]}];this.messagesSubject.next(e),this.saveMessagesToStorage()}createMockConversations(){const e=[{id:"conv-001",subject:"Error al generar PDF de receta",topic:this.MESSAGE_TOPICS[1],participants:["user-001","admin-001"],unreadCount:1,status:"active",createdAt:new Date(Date.now()-864e5),updatedAt:new Date(Date.now()-864e5)},{id:"conv-002",subject:"Solicitud acceso a m\xf3dulo de reportes",topic:this.MESSAGE_TOPICS[2],participants:["user-001","admin-001"],unreadCount:0,status:"closed",createdAt:new Date(Date.now()-1728e5),updatedAt:new Date(Date.now()-1728e5)},{id:"conv-003",subject:"Consulta sobre cambio de contrase\xf1a",topic:this.MESSAGE_TOPICS[0],participants:["user-001","admin-001"],unreadCount:0,status:"active",createdAt:new Date(Date.now()-2592e5),updatedAt:new Date(Date.now()-2592e5)},{id:"conv-004",subject:"Problema con la firma digital",topic:this.MESSAGE_TOPICS[1],participants:["user-001","admin-001"],unreadCount:0,status:"archived",createdAt:new Date(Date.now()-6048e5),updatedAt:new Date(Date.now()-6048e5)}];this.conversationsSubject.next(e),this.saveConversationsToStorage()}static{this.\u0275fac=function(r){return new(r||i)}}static{this.\u0275prov=S.jDH({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})()},204:(E,f,o)=>{o.d(f,{c:()=>I});var u=o(8839),g=o(8793),c=o(6697),d=o(9974),S=o(4360),p=o(5343),A=o(3703),e=o(1397),r=o(8750);function s(l,v){return v?m=>(0,g.x)(v.pipe((0,c.s)(1),function i(){return(0,d.N)((l,v)=>{l.subscribe((0,S._)(v,p.l))})}()),m.pipe(s(l))):(0,e.Z)((m,b)=>(0,r.Tg)(l(m,b)).pipe((0,c.s)(1),(0,A.u)(m)))}var t=o(1985),a=o(9470);function I(l,v=u.E){const m=function h(l=0,v,m=u.b){let b=-1;return null!=v&&((0,a.m)(v)?m=v:b=v),new t.c(D=>{let M=function n(l){return l instanceof Date&&!isNaN(l)}(l)?+l-m.now():l;M<0&&(M=0);let C=0;return m.schedule(function(){D.closed||(D.next(C++),0<=b?this.schedule(void 0,b):D.complete())},M)})}(l,v);return s(()=>m)}},8839:(E,f,o)=>{o.d(f,{b:()=>r,E:()=>e});var u=o(8359);class g extends u.yU{constructor(t,a){super()}schedule(t,a=0){return this}}const c={setInterval(s,t,...a){const{delegate:n}=c;return n?.setInterval?n.setInterval(s,t,...a):setInterval(s,t,...a)},clearInterval(s){const{delegate:t}=c;return(t?.clearInterval||clearInterval)(s)},delegate:void 0};var d=o(7908),p=o(6129);class i{constructor(t,a=i.now){this.schedulerActionCtor=t,this.now=a}schedule(t,a=0,n){return new this.schedulerActionCtor(this,t).schedule(n,a)}}i.now=p.U.now;const e=new class A extends i{constructor(t,a=i.now){super(t,a),this.actions=[],this._active=!1}flush(t){const{actions:a}=this;if(this._active)return void a.push(t);let n;this._active=!0;do{if(n=t.execute(t.state,t.delay))break}while(t=a.shift());if(this._active=!1,n){for(;t=a.shift();)t.unsubscribe();throw n}}}(class S extends g{constructor(t,a){super(t,a),this.scheduler=t,this.work=a,this.pending=!1}schedule(t,a=0){var n;if(this.closed)return this;this.state=t;const h=this.id,I=this.scheduler;return null!=h&&(this.id=this.recycleAsyncId(I,h,a)),this.pending=!0,this.delay=a,this.id=null!==(n=this.id)&&void 0!==n?n:this.requestAsyncId(I,this.id,a),this}requestAsyncId(t,a,n=0){return c.setInterval(t.flush.bind(t,this),n)}recycleAsyncId(t,a,n=0){if(null!=n&&this.delay===n&&!1===this.pending)return a;null!=a&&c.clearInterval(a)}execute(t,a){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const n=this._execute(t,a);if(n)return n;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(t,a){let h,n=!1;try{this.work(t)}catch(I){n=!0,h=I||new Error("Scheduled action threw falsy error")}if(n)return this.unsubscribe(),h}unsubscribe(){if(!this.closed){const{id:t,scheduler:a}=this,{actions:n}=a;this.work=this.state=this.scheduler=null,this.pending=!1,(0,d.o)(n,this),null!=t&&(this.id=this.recycleAsyncId(a,t,null)),this.delay=null,super.unsubscribe()}}}),r=e},6129:(E,f,o)=>{o.d(f,{U:()=>u});const u={now:()=>(u.delegate||Date).now(),delegate:void 0}},4523:(E,f,o)=>{function u(c,d,S,p,i,A,e){try{var r=c[A](e),s=r.value}catch(t){return void S(t)}r.done?d(s):Promise.resolve(s).then(p,i)}function g(c){return function(){var d=this,S=arguments;return new Promise(function(p,i){var A=c.apply(d,S);function e(s){u(A,p,i,e,r,"next",s)}function r(s){u(A,p,i,e,r,"throw",s)}e(void 0)})}}o.d(f,{A:()=>g})}}]);